<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="utf-8">
    <title>Display a map on a webpage</title>
    <th:block th:replace="partials/header :: font"></th:block>
    <th:block th:replace="partials/Navbar :: styles"></th:block>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
<!--    <script  type="text/javascript" th:src="@{/js/keys.js}"></script>-->
    <script  type="text/javascript" th:src="@{/js/geocoder.js}"></script>
    <script type="text/javascript" th:src="@{/keys.js}"></script>


    <th:block th:replace="partials/Navbar :: styles"></th:block>
    <style>
        #mapContainer {
            height: 100vh;
            width: 75%;
        }
        #map {
            height: 100%;
            width: 100%;
            border-radius: 15px;
        }


    </style>
</head>
<body>
<nav th:replace="~{partials/Navbar::navbar}"></nav>

<h1><span th:text="${name}"></span></h1>
<th:block sec:authorize="isAuthenticated()">
    <a th:href="@{/brewery/{id}/create-review(id=${id})}"><button>Create Review</button></a>
    <form th:if="${favCheck == 'false'}" th:action="@{/brewery/{id}/favorite(id=${id})}" th:method="post">
        <button type="submit">Add to Favorites</button>
    </form>
    <form th:if="${wishCheck == 'false'}" th:action="@{/brewery/{id}/wishlist(id=${id})}" th:method="post">
        <button type="submit">Add to Wishlist</button>
    </form>
</th:block>
<input type="hidden" id="city" th:value="${city}"/>
<div id="mapContainer">
    <div id='map'></div>
</div>


<script src="https://code.jquery.com/jquery-3.7.0.js" integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM=" crossorigin="anonymous"></script>
<th:block th:replace="partials/Navbar :: scripts"></th:block>


<script>
    let city = $('#city').val();
    console.log(city);
    mapboxgl.accessToken = MAPBOX_TOKEN
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        zoom: 12,
        center: [-96.4558196, 32.6279113],
        cooperativeGestures: true
    });

    geocode(city, MAPBOX_TOKEN).then(function(result) {
        console.log
        $('#weather').empty();
        map.jumpTo({
            center: [result[0], result[1]],
            essential: true,
        });

        new mapboxgl.Marker()
            .setLngLat([result[0], result[1]])
            .addTo(map);
    });

</script>
</body>
</html>